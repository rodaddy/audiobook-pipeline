# Audiobook Pipeline Configuration
# Copy to config.env and adjust paths for your system.

# ─── Directories ─────────────────────────────────────────────────────────────
WORK_DIR="/var/lib/audiobook-pipeline/work"
MANIFEST_DIR="/var/lib/audiobook-pipeline/manifests"
OUTPUT_DIR="/var/lib/audiobook-pipeline/output"
LOG_DIR="/var/log/audiobook-pipeline"

# ─── Encoding ────────────────────────────────────────────────────────────────
# MAX_BITRATE: Cap output bitrate (kbps). Source bitrate is matched up to this cap.
#   Default: 128. Set lower for smaller files (e.g., 64 for speech-only content).
MAX_BITRATE=128

# CHANNELS: Audio channels. 1=mono (default, recommended for speech), 2=stereo.
CHANNELS=1

# ─── Permissions ──────────────────────────────────────────────────────────────
# FILE_OWNER: chown target for output files (e.g., "1000:1000"). Leave empty to skip.
FILE_OWNER=""
FILE_MODE="644"
DIR_MODE="755"

# ─── Behavior ────────────────────────────────────────────────────────────────
DRY_RUN="${DRY_RUN:-false}"
FORCE="${FORCE:-false}"
VERBOSE="${VERBOSE:-false}"
CLEANUP_WORK_DIR=true
LOG_LEVEL="INFO"

# ─── Metadata ────────────────────────────────────────────────────────────────
METADATA_SOURCE="audible"     # Primary metadata source: "audible" or "audnexus"
AUDIBLE_REGION="com"          # Audible API domain: com, co.uk, com.au, ca, de, fr, co.jp, in, it, es
AUDNEXUS_REGION="us"          # Audnexus region (used as fallback): us, uk, au, ca, de, fr, jp, in, it, es
AUDNEXUS_CACHE_DIR=""         # Defaults to WORK_DIR if empty
AUDNEXUS_CACHE_DAYS=30        # Cache metadata responses for N days
CHAPTER_DURATION_TOLERANCE=5  # Percent tolerance for chapter duration matching
METADATA_SKIP=false           # Set true to skip metadata enrichment entirely
FORCE_METADATA=false          # Set true to re-fetch metadata even if cached

# ─── Folder Organization ─────────────────────────────────────────────────────
# NFS_OUTPUT_DIR: Plex/Audiobookshelf library root.
# Output structure: Author/Book (Year)/Book.m4b
NFS_OUTPUT_DIR="/mnt/media/AudioBooks"
CREATE_COMPANION_FILES=true   # Deploy cover.jpg, desc.txt, reader.txt alongside M4B

# ─── Archive ──────────────────────────────────────────────────────────────────
ARCHIVE_DIR="/var/lib/audiobook-pipeline/archive"
ARCHIVE_RETENTION_DAYS=90

# ─── Concurrency ─────────────────────────────────────────────────────────────
LOCK_DIR="/var/lib/audiobook-pipeline/locks"

# ─── Automation (cron scanner + Readarr webhook) ──────────────────────────────
INCOMING_DIR="/mnt/media/AudioBooks/_incoming"
QUEUE_DIR="/var/lib/audiobook-pipeline/queue"
PROCESSING_DIR="/var/lib/audiobook-pipeline/processing"
COMPLETED_DIR="/var/lib/audiobook-pipeline/completed"
FAILED_DIR="/var/lib/audiobook-pipeline/failed"
PIPELINE_BIN="/opt/audiobook-pipeline/bin/audiobook-convert"
STABILITY_THRESHOLD=120       # Seconds -- cron scanner skips recently modified books

# ─── Error Recovery ──────────────────────────────────────────────────────────
MAX_RETRIES=3
FAILURE_WEBHOOK_URL=""        # Slack/Discord webhook for failure notifications
FAILURE_EMAIL=""              # Future: email notifications
